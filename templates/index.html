<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FER Chatbot</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* -------------------- GLOBAL -------------------- */
* {
    box-sizing: border-box;
    font-family: "Segoe UI", Arial, sans-serif;
}

body {
    margin: 0;
    background: #0e0e0e;
    color: #e0e0e0;
    display: flex;
    justify-content: center;
    min-height: 100vh;
}

/* -------------------- MAIN CONTAINER -------------------- */
.container {
    width: 100%;
    max-width: 900px;
    padding: 30px 20px;
}

/* -------------------- HEADER -------------------- */
h2 {
    text-align: center;
    font-weight: 500;
    letter-spacing: 1px;
    margin-bottom: 20px;
    color: #f5f5f5;
}

/* -------------------- VIDEO CARD -------------------- */
.video-card {
    background: #1a1a1a;
    border-radius: 14px;
    padding: 15px;
    box-shadow: 0 0 25px rgba(0,0,0,0.6);
    text-align: center;
}

.video-card img {
    width: 100%;
    max-width: 640px;
    border-radius: 10px;
    border: 1px solid #333;
}

/* -------------------- CONTROLS -------------------- */
.controls {
    margin-top: 15px;
    text-align: center;
}

button {
    background: linear-gradient(135deg, #2f2f2f, #3b3b3b);
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    transition: 0.3s ease;
}

button:hover {
    background: linear-gradient(135deg, #3a3a3a, #4a4a4a);
}

#emotion {
    margin-top: 10px;
    font-size: 15px;
    color: #9f9f9f;
}

/* -------------------- CHAT -------------------- */
.chat {
    margin-top: 30px;
    background: #141414;
    border-radius: 14px;
    padding: 15px;
    box-shadow: 0 0 25px rgba(0,0,0,0.6);
}

#chat-box {
    height: 260px;
    overflow-y: auto;
    padding: 10px;
    border-radius: 10px;
    background: #0f0f0f;
    border: 1px solid #2a2a2a;
}

/* Messages */
.user, .bot {
    margin: 8px 0;
    padding: 8px 12px;
    border-radius: 10px;
    max-width: 80%;
    font-size: 14px;
}

.user {
    background: #2b2b2b;
    align-self: flex-end;
    margin-left: auto;
    text-align: right;
}

.bot {
    background: #1f1f1f;
    color: #cfcfcf;
}

/* -------------------- INPUT -------------------- */
.input-area {
    display: flex;
    gap: 10px;
    margin-top: 12px;
}

input {
    flex: 1;
    background: #0f0f0f;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 10px;
    color: #fff;
    outline: none;
}

input::placeholder {
    color: #777;
}

/* -------------------- SCROLLBAR -------------------- */
#chat-box::-webkit-scrollbar {
    width: 6px;
}

#chat-box::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 6px;
}

/* -------------------- MOBILE -------------------- */
@media (max-width: 600px) {
    #chat-box {
        height: 220px;
    }
}
</style>
</head>

<body>

<div class="container">

<h2>Facial Emotion Recognition Chatbot</h2>

<div class="video-card">
    <img src="/video_feed">
    <div class="controls">
        <button onclick="startScan()">Start Emotion Scan (5s)</button>
        <p id="emotion"></p>
    </div>
</div>

<div class="chat">
    <div id="chat-box"></div>
    <div class="input-area">
        <input id="msg" placeholder="Type your message..."
               onkeydown="if(event.key==='Enter') sendMsg()">
        <button onclick="sendMsg()">Send</button>
    </div>
</div>

</div>

<script>
function startScan() {
    fetch("/start_scan")
    .then(res => res.json())
    .then(data => {
        document.getElementById("emotion").innerText =
            "Detected Emotion: " + data.emotion;
    });
}

function sendMsg() {
    let input = document.getElementById("msg");
    let text = input.value.trim();
    if (!text) return;

    let box = document.getElementById("chat-box");
    box.innerHTML += `<div class="user">${text}</div>`;
    input.value = "";
    box.scrollTop = box.scrollHeight;

    fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: text})
    })
    .then(res => res.json())
    .then(data => {
        box.innerHTML += `<div class="bot">(${data.emotion}) ${data.reply}</div>`;
        box.scrollTop = box.scrollHeight;
    });
}
</script>

</body>
</html>
